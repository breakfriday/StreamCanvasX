"use strict";(self.webpackChunkstreamcanvasx=self.webpackChunkstreamcanvasx||[]).push([[324],{4132:(e,t,i)=>{i.r(t),i.d(t,{default:()=>o});var n=i(2650),r=i(2157).Z;const o=function(){return r(n.Z,null,(function(){var e=i(2742).Z;return r(e,null)}))}},2742:(e,t,i)=>{i.d(t,{Z:()=>E});var n=i(2983),r=(i(171),i(9768)),o=new r.W,a=(new r.W,i(762)),s=i(5992),l=i(2617),u=i(1138),c=i(2545),v=i(6398),d=i(9513),h=i(6269),f=i.n(h),y=function(){function e(t){(0,s._)(this,e),(0,u._)(this,"video",void 0),(0,u._)(this,"canvas",void 0),(0,u._)(this,"context",void 0),(0,u._)(this,"mpegtsPlayer",void 0),(0,u._)(this,"root_el",void 0),(0,u._)(this,"aspectRatio",void 0),(0,u._)(this,"metadata",void 0),(0,u._)(this,"config",void 0),this.video=document.createElement("video"),this.video.controls=!0,this.canvas=t.canvas_el,this.root_el=t.root_el,this.config=t.config||{},this.canvas&&(this.context=this.canvas.getContext("2d")),this.root_el.innerHTML="",this.root_el.appendChild(this.video),this.setVideoSize(),this.vedioEvents()}return(0,l._)(e,[{key:"_vedio",get:function(){return this.video}},{key:"createFlvPlayer",value:function(e){var t=this,i=e.type,n=e.isLive,r=e.url,o=this.video;o&&(this.mpegtsPlayer=f().createPlayer({type:i,isLive:n,url:r,hasAudio:!0}),this.mpegtsPlayer.attachMediaElement(o),this.getVideoSize(),this.mpegtsPlayer.load(),this.mpegtsPlayer.on(f().Events.MEDIA_INFO,(function(e){var i=e.metadata.width,n=e.metadata.height;t.metadata={video_height:n,video_width:i},t.getVideoSize()})),this.mpegtsPlayer.on(f().Events.METADATA_ARRIVED,(function(e){t.mpegtsPlayer.play()})),this.mpegtsPlayer.on(f().Events.ERROR,(function(e,i){if(e===f().ErrorTypes.NETWORK_ERROR&&(i===f().ErrorDetails.NETWORK_UNRECOVERABLE_EARLY_EOF&&t.reoload(),i===f().ErrorDetails.NETWORK_TIMEOUT))return!1})))}},{key:"setConfig",value:function(e){this.config=Object.assign({},this.config,e)}},{key:"load",value:function(){this.mpegtsPlayer.load()}},{key:"play",value:function(){this.mpegtsPlayer.play()}},{key:"paused",value:function(){this.mpegtsPlayer.pause()}},{key:"reoload",value:function(){this.mpegtsPlayer.unload(),this.mpegtsPlayer.detachMediaElement(),this.mpegtsPlayer.attachMediaElement(this.video),this.mpegtsPlayer.load(),this.mpegtsPlayer.play()}},{key:"set_blob_url",value:function(e){var t=URL.createObjectURL(e);this.video.src=t,this.video.load()}},{key:"vedioEvents",value:function(){var e=this;this.loadMediaEvent(),this.video.addEventListener("play",(function(){e.analyzeCanvas.call(e)}),!1)}},{key:"getVideoSize",value:function(){var e={},t=e.videoHeight,i=void 0===t?0:t,n=e.videoWidth,r=void 0===n?0:n;this.metadata?(r=this.metadata.video_width,i=this.metadata.video_height):(i=this.video.videoHeight,r=this.video.videoWidth);var o=function e(t,i){return 0===i?t:e(i,t%i)}(r,i),a=r/o,s=i/o,l="".concat(a,":").concat(s);this.aspectRatio=a/s,console.log("------------------------"),console.log(l),console.log("------------------------")}},{key:"loadMediaEvent",value:function(){var e=this,t=this.video;t&&t.addEventListener("loadedmetadata",(function(){e.getVideoSize()}))}},{key:"setVideoSize",value:function(){var e=this.root_el.clientHeight,t=this.root_el.clientWidth;this.video.height=e,this.video.width=t}},{key:"renderByWebGpu",value:function(){var e=this;return(0,a._)((function(){var t,i,n;return(0,v.Jh)(this,(function(r){switch(r.label){case 0:return[4,navigator.gpu.requestAdapter()];case 1:return[4,r.sent().requestDevice()];case 2:return t=r.sent(),i=t.createTexture({size:{width:e.video.videoWidth,height:e.video.videoHeight,depth:1},format:"rgba8unorm",usage:window.GPUTextureUsage.COPY_DST|window.GPUTextureUsage.RENDER_ATTACHMENT}),(n=function(){t.queue.copyExternalImageToTexture({source:e.video},{texture:i},[e.video.videoWidth,e.video.videoHeight,1]),requestAnimationFrame(n.bind(e))}).call(e),[2]}}))}))()}},{key:"analyzeCanvas",value:function(){var e=this,t=this.canvas.width,i=this.canvas.height/this.aspectRatio,n=this.context.getImageData(0,0,1,1),r=(0,c._)(n.data,3);r[0],r[1],r[2];!function n(){e.video.ended||e.video.paused||(e.context.drawImage(e.video,0,0,t,i),requestAnimationFrame(n.bind(e)))}()}}]),e}();const g=y=(0,v.gn)([(0,d.b)()],y);var m={IOriginSerivce:Symbol.for("IOriginSerivce"),IServiceA:Symbol.for("IServiceA"),IAudioProcessingService:Symbol.for("IAudioProcessingService"),IMainPlayerService:Symbol.for("IMainPlayerService"),IPlayerService:Symbol.for("IPlayerService"),IHttpFlvStreamLoader:Symbol.for("IHttpFlvStreamLoader"),IFLVDemuxService:Symbol.for(" IFLVDemuxService"),IWebcodecsDecoderService:Symbol.for("IWebcodecsDecoderService"),ICanvasVideoService:Symbol.for("ICanvasVideoService"),IDebugLogService:Symbol.for("IDebugLogService"),IFLVDemuxStream:Symbol.for("IFLVDemuxStream")};o.bind(m.IMainPlayerService).toFactory((function(e){return function(e){return new g(e)}}));var p=i(2157).Z,S=i(2983).Fragment,b=n.useRef,_=n.useEffect;const E=function(){var e=n.useRef(null),t=n.useRef(null),i=b(null);return _((function(){var n,r=(n={root_el:null==e?void 0:e.current,canvas_el:null==t?void 0:t.current},o.get(m.IMainPlayerService)(n));i.current=r}),[]),p(S,null,p("div",null,p("input",{type:"file",id:"file-input",accept:"audio/*,video/*",onChange:function(e){var t,n,r=i.current,o=null==(t=e.target)||null==(n=t.files)?void 0:n[0];o&&r.set_blob_url(o)}}),p("div",{ref:e,style:{width:"300px",height:"300px"}}),p("canvas",{ref:t,width:"300",height:"300"})))}},762:(e,t,i)=>{function n(e,t,i,n,r,o,a){try{var s=e[o](a),l=s.value}catch(u){return void i(u)}s.done?t(l):Promise.resolve(l).then(n,r)}function r(e){return function(){var t=this,i=arguments;return new Promise((function(r,o){var a=e.apply(t,i);function s(e){n(a,r,o,s,l,"next",e)}function l(e){n(a,r,o,s,l,"throw",e)}s(void 0)}))}}i.d(t,{_:()=>r})},5992:(e,t,i)=>{function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}i.d(t,{_:()=>n})},2617:(e,t,i)=>{function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}i.d(t,{_:()=>r})},2545:(e,t,i)=>{function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var n,r,o=[],a=!0,s=!1;try{for(i=i.call(e);!(a=(n=i.next()).done)&&(o.push(n.value),!t||o.length!==t);a=!0);}catch(l){s=!0,r=l}finally{try{a||null==i.return||i.return()}finally{if(s)throw r}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return n(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(i):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?n(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}i.d(t,{_:()=>r})}}]);